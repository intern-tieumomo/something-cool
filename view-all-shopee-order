var totalOrders = 0;
var totalSpent = 0;
var totalShippingSpent = 0;
var totalItems = 0;
var pulling = true;
var offset = 0;

function getStatistics() {
	var orders = [];
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			orders = JSON.parse(this.responseText)['orders'];
			totalOrders += orders.length;
			pulling = orders.length >= 10;
			orders.forEach(order => {
                console.log("%cğŸ’¸ ÄÃ‚Y LÃ€ Má»˜T ÄÆ N HÃ€NG ", "font-size: 30px; color:blue");
				let tpa = order["paid_amount"] / 100000;
				totalSpent += tpa;
				let tpsa = order["shipping_fee"] / 100000;
                totalShippingSpent += tpsa;
                order["items"].forEach(item => {
                    let tpti = item["amount"];
                    console.log("%cğŸ“Œ TÃªn sáº£n pháº©m: " + "%c" + item["name"], "font-size: 15px;","font-size: 15px; color:red");
                    console.log("%cğŸ”¢ Sá»‘ lÆ°á»£ng: " + "%c" + item["amount"], "font-size: 15px;","font-size: 15px; color:red");
                    console.log("%cğŸ’² GiÃ¡: " + "%c" + moneyFormat(item["order_price"] / 100000) + "Ä‘", "font-size: 15px;","font-size: 15px; color:red");
                    totalItems += tpti;
                });
                console.log("%cğŸ›µ Tiá»n ship: " + "%c" + moneyFormat(order["payment_info"]["shipping_fee"] / 100000) + "Ä‘", "font-size: 15px;","font-size: 15x; color:red");
                console.log("%cğŸ’µ Tá»•ng tiá»n: " + "%c" + moneyFormat(order["payment_info"]["price_before_discount"] / 100000) + "Ä‘", "font-size: 15px;","font-size: 15px; color:red");
                console.log("%cğŸ’¸ Tá»•ng tiá»n cuá»‘i cÃ¹ng pháº£i thanh toÃ¡n sau khi trá»« khuyáº¿n máº¡i: " + "%c" + moneyFormat(order["payment_info"]["total_price"] / 100000) + "Ä‘", "font-size: 20px;","font-size: 30px; color:red");
                console.log("--------------------------------------------");
			});
			offset += 10;
			console.log('ÄÃ£ láº¥y Ä‘Æ°á»£c: ' + totalOrders + ' Ä‘Æ¡n hÃ ng');
			if(pulling) {
				console.log('Äang kÃ©o thÃªm...');
				getStatistics();
			}
			else {
				console.log("%cTá»•ng Ä‘Æ¡n hÃ ng Ä‘Ã£ giao: "+"%c"+moneyFormat(totalOrders), "font-size: 30px;","font-size: 30px; color:red");
                console.log("%cTá»•ng sáº£n pháº©m Ä‘Ã£ Ä‘áº·t: " + "%c" + moneyFormat(totalItems), "font-size: 30px;","font-size: 30px; color:red");
				console.log("%cTá»•ng chi tiÃªu: "+"%c"+moneyFormat(totalSpent)+"Ä‘", "font-size: 30px;","font-size: 30px; color:red");
				console.log("%cTá»•ng tiá»n ship: "+"%c"+moneyFormat(totalShippingSpent)+"Ä‘", "font-size: 30px;","font-size: 30px; color:red");
			}
		}
	};
	xhttp.open("GET", "https://shopee.vn/api/v1/orders/?order_type=3&offset=" + offset + "&limit=10", true);
	xhttp.send();
}

function moneyFormat(number, fixed=0) {
	if(isNaN(number)) return 0;
	number = number.toFixed(fixed);
	let delimeter = ',';
	number += '';
	let rgx = /(\d+)(\d{3})/;
	while (rgx.test(number)) {
		number = number.replace(rgx, '$1' + delimeter + '$2');
	}
	return number;
}getStatistics()
